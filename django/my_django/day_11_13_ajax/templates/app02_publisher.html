<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>publisher_list</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'bootstrap-3.3.7-dist/css/bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'awesome/sweetalert.css' %}">
    <style>
        th {
            text-align: center !important;
        }

        div.sweet-alert.showSweetAlert h2 {
            margin-top: 30px;
        }

    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 col-md-offset-2" style="margin-top: 70px">
            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#add_publisher">
                <span class="glyphicon glyphicon-plus"></span>添加出版社
            </button>
            <a href="{% url 'app02:app02_login_out' %}"><button type="button" class="btn btn-success">注销</button></a>
            {% csrf_token %}
            <table border="1" class="table table-bordered table-hover text-center">
                <thead>
                <tr class="info text-center">
                    <th>序号</th>
                    <th>id</th>
                    <th>出版社名称</th>
                    <th>出版的书籍</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                {% for item in publisher_list %}
                    <tr class="text-center" pid="{{ item.id }}">
                        <td>{{ forloop.counter }}</td>
                        <td>{{ item.id }}</td>
                        <td>{{ item.name }}</td>
                        <td>
                            {% for book in item.book_set.all %}
                                {% if forloop.last %}
                                    《{{ book.title }}》
                                {% else %}
                                    《{{ book.title }}》，
                                {% endif %}
                            {% empty %}
                                暂无书籍出版
                            {% endfor %}
                        </td>
                        <td>
                            <button type="button" class="btn btn-danger" id="ajax-del">
                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                            </button>
                            |
                            <button type="button" class="btn btn-primary">
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>编辑
                            </button>

                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script src="{% static 'jquery.js' %}"></script>
<script src="{% static 'bootstrap-3.3.7-dist/js/bootstrap.js' %}"></script>
<script src="{% static 'awesome/sweetalert.js' %}"></script>
<script src="{% static 'csrf.js' %}"></script>

<script>
    {#var csrftoken = getCookie('csrftoken');#}
    //给删除按钮绑定点击事件
    $("table").on("click", "#ajax-del", function () {
        //获取被点击的当前id
        var p_id = $(this).parent().parent().attr("pid");
        swal({
                title: "确定要删除吗?",
                text: "删除后不可撤回!",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: false
            },
            //点确定后执行，通过ajax发送数据，在后台删除
            function () {
                $.ajax({
                    url: {% url 'del_publisher' %},
                    type: "POST",
                    data: {"pid": p_id, "csrfmiddlewaretoken": $('[name="csrfmiddlewaretoken"]').val()},
                    success: function (ret) {
                        if (ret.status === 1) {
                            //后台数据删除后也要删除当前页面的数据
                            $("[pid=" + p_id + "]").remove();
                            swal('删除成功', '准备跑路吧！', 'success');
                        } else {
                            swal('删除失败', ret.err_msg, 'error');
                        }

                    }
                })
            });

    })
</script>

</body>
</html>